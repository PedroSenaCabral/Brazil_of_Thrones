<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Stylish Portfolio - Start Bootstrap Template</title>

    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/stylish-portfolio.min.css" rel="stylesheet">

  </head>

  <body id="page-top">

   
    <!-- Header -->
    <header class="masthead d-flex">
      
      <div class="col-md-6">
        
          <div class="container">
        <img class="pergaminho" src="img/tela2.png">
        <label class="conteudo">
	  <subtitle>A Guerra de Farrapos</subtitle><br \><br \>
	  
	  <p><strong> Conflito regional:</strong><br />
	  Possui uma cultura própria derivada do amálgama da cultura ibérica e indígena que habitavam o pampa.</p>
	  
	  <p><strong> Conflito regional:</strong><br />	  
	  A Guerra dos Farrapos foi um conflito de caráter republicano, contra o governo imperial do Brasil, e que resultou na declaração de independência da província como estado republicano. Ocorreu entre 1835 e 1845, inicialmente reivindicando a retirada de todos os portugueses que se mantinham nos mais altos cargos do Império e do Exército, mesmo depois da Independência. No entanto, a revolução adquiriu um caráter separatista.</p>

            <br>
            <strong> Clique no estado em que ocorreu essa guerra. </strong>

           <br>
             <span id="estado"></span>
          <div id="dadosLojas" > 

          </div>
        </label>

      </div>
      </div>
    

        <div class="col-md-6"> 
        <div id="regions_div" style="width: 900px; height: 500px;"></div>
      </div>


      <div class="overlay"></div>
    </header>

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded js-scroll-trigger" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>
     
    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/stylish-portfolio.min.js"></script>


    <script type="text/javascript" src="js/loader.js"></script>
    <script type="text/javascript" src="js/jsapi.js"></script>
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>

    <script type="text/javascript">
      google.charts.load('current', {'packages':['geochart']});
      google.charts.setOnLoadCallback(drawRegionsMap);

      dicEstados = {
          '1' : 'Parana',
          '2' : 'Rio Grande do Sul',       
          '3' : 'Santa Catarina',

        }
        //o array abaixo pode ser alimentado por uma base de dados, ou api rest. no exemplo, deixei fixo.
        unidades = {
        
          'Rio Grande do Sul':
           {
            '0' : 
            {
              '' : 'Resposta correta, o estado do Rio Grande do Sul foi onde aconteceu a Farroupilha',

            }, '1' :
            {
              '' : 'Ilheus',
             
            }
          }
        }

      var ultimoEstadoSelecionado = '';


      function drawRegionsMap() {

        var data = google.visualization.arrayToDataTable([
          ['Country'],
          ['Brazil'],
          ['Parana'],
          ['Rio Grande do Sul'],
          ['Santa Catarina']
        ]);

        var options = {
           region: 'BR',
           resolution: 'provinces',
           datalessRegionColor: '#F1F2F3',
           defaultColor: '#A0522D',
           enableRegionInteractivity: true,
          backgroundColor: '#cc8f45'

        };

        var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));
        
        function myClickHandler(){
          var selection = chart.getSelection();
          var message = '';
          for (var i = 0; i < selection.length; i++) {
              var item = selection[i];
              if (item.row != null && item.column != null) {
                  message += '{' + item.row + ',column:' + item.column + '}';
              } else if (item.row != null) {
                  message += '' + item.row + '';
              } else if (item.column != null) {
                  message += '{column:' + item.column + '}';
              }
          }
          if (message == '') {
              message = ultimoEstadoSelecionado;
          }else{
              ultimoEstadoSelecionado = message;
          }
            document.getElementById("dadosLojas").innerHTML = '';
            for(var i = 0; i < Object.keys(unidades).length; i ++){ 
              document.getElementById("estado").innerHTML = dicEstados[message];
              //Ponto de melhoria, percorrer o array apenas nos itens relacionados ao estado clicado/marcado. (lazy)
              if(unidades[dicEstados[message]] != undefined){
                document.getElementById("dadosLojas").innerHTML += 
                '<br> ' + 
                unidades[dicEstados[message]][i][''] + 
                + '<br>';
              }             
            }
          }

          google.visualization.events.addListener(chart, 'select', myClickHandler);

          chart.draw(data, options);

          $('#seletorCombo').change(function(){
            valEstado = $(this).val();
            arraySelection = [];
            arraySelection.push({column:null,row:Number(valEstado)});


            function myComboHandler(option){
              var selection = option;
              console.log(selection);
              var message = '';
              for (var i = 0; i < selection.length; i++) {
                  var item = selection[i];
                  if (item.row != null && item.column != null) {
                      message += '{' + item.row + ',column:' + item.column + '}';
                  } else if (item.row != null) {
                      message += '' + item.row + '';
                  } else if (item.column != null) {
                      message += '{column:' + item.column + '}';
                  }
              }
              if (message == '') {
                  message = '';
                  return false;
              }
                document.getElementById("dadosLojas").innerHTML = '';
                for(var i = 0; i < Object.keys(unidades).length;  i ++){ 
                  document.getElementById("estado").innerHTML = dicEstados[message];
                  document.getElementById("dadosLojas").innerHTML += 
                  '' + 
                  unidades[dicEstados[message]][i][''] + 
                  '<br> ' + 
                  + '<br>';
                }
              }
            

            google.visualization.events.addListener(chart, 'select', myComboHandler);

              chart.draw(data, options);

              myComboHandler(arraySelection);
        });
      }



    </script>


  </body>

</html>
